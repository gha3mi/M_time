  gfortran-windows-msys2-mingw64:
    runs-on: windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v1

    - name: Setup MinGW (MSYS2)
      uses: msys2/setup-msys2@v2
      with:
        msystem: MINGW64
        update: false
        install: >-
          git
          wget
          mingw-w64-x86_64-gcc-fortran

    - name: Install fpm
      shell: msys2 {0}
      run: |
        wget https://github.com/awvwgk/mingw-w64-fpm-pkgbuild/releases/download/current/mingw-w64-x86_64-fpm-0.2.0-1-any.pkg.tar.zst
        pacman -U --noconfirm mingw-w64-x86_64-fpm-*-any.pkg.tar.zst

    - name: Run tests and demo programs (debug)
      shell: msys2 {0}
      run: |
        gfortran --version
        fpm test
        fpm run *-demo

    - name: Run tests and demo programs (release)
      shell: msys2 {0}
      run: |
        gfortran --version
        fpm test --profile release
        fpm run *-demo --profile release
